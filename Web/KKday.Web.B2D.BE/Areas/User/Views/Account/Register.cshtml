@using KKday.Web.B2D.BE.Models.Model.Common
@using Resources

@inject ILocalizer localizer
@{
    Layout = "_LayoutShell";
    var countryAreas = (List<CountryArea>)ViewData["CountryAreas"];
    var countryLocales = (List<CountryLocale>)ViewData["CountryLocales"];
    //var timeZone = (List<TimezoneModel>)ViewData["TimeZone"];
}
@section Scripts{
    <script src="https://momentjs.com/downloads/moment.min.js" asp-append-version="true"></script>
    <script src="https://momentjs.com/downloads/moment-timezone.min.js" asp-append-version="true"></script>
    <script src="https://momentjs.com/downloads/moment-timezone-with-data.min.js" asp-append-version="true"></script>
}
@section Stylesheet{

}
<form id="form_register">
    <div class="page-wrap">
        <div class="container">
            <div class="row">
                <div class="col-lg-10 col-lg-offset-1">
                    <h1 class="title">@localizer.Text.Register</h1>
                    <hr>
                    <div class="row">
                        <div class="col-md-3">
                            <h2 class="section-title">@localizer.Text.UserProfile</h2>
                        </div>
                        <div class="col-md-9">
                            <div class="row">
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label>@localizer.Text.GenderTitle</label>
                                        <select id="gender_title" name="gender_title" class="form-control">
                                            <option value="">@localizer.Text.Select</option>
                                            <option value="mr">Mr.</option>
                                            <option value="miss">Miss.</option>
                                            <option value="mrs">Mrs.</option>
                                            <option value="ms">Ms.</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-5">
                                    <div class="form-group">
                                        <label>@localizer.Text.NameLast<span class="text-danger">*</span></label>
                                        <input id="name_last" name="name_last" type="text" class="form-control" placeholder="@localizer.Text.Search_Name_Last">
                                    </div>
                                </div>
                                <div class="col-sm-5">
                                    <div class="form-group">
                                        <label>@localizer.Text.NameFirst<span class="text-danger">*</span></label>
                                        <input id="name_first" name="name_first" type="text" class="form-control" placeholder="@localizer.Text.Search_Name_First">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>@localizer.Text.Email<span class="text-danger">*</span></label>
                                        <input id="email" name="email" type="email" class="form-control" placeholder="example@domain.com">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>@localizer.Text.JobTitle</label>
                                        <input id="job_title" type="text" class="form-control">
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>@localizer.Text.NewPassword<span class="text-danger">*</span></label>
                                        <input id="password" name="password" type="password" class="form-control">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>@localizer.Text.PasswordAgain<span class="text-danger">*</span></label>
                                        <input id="password_again" name="password_again" type="password" class="form-control">
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label>@localizer.Text.CountryANDTelCode<span class="text-danger">*</span></label>
                                        <select id="country_area" class="form-control">
                                            <option value="">@localizer.Text.Select</option>
                                            @foreach (var country in countryAreas.OrderBy(c => c.telArea))
                                            {
                                                <option value="@(country.countryCode + "," + country.telArea)"> @country.countryName (+@(country.telArea))</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label>@localizer.Text.TimeZone<span class="text-danger">*</span></label>
                                        <select id="timezone" name="timezone" class="form-control">
                                            <option value="">@localizer.Text.Select</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group">
                                        <label>@localizer.Text.Tel<span class="text-danger">*</span></label>
                                        <input id="tel" name="tel" type="tel" class="form-control">
                                    </div>
                                </div>

                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>@localizer.Text.Locale<span class="text-danger">*</span></label>
                                        <select id="locale" name="locale" class="form-control">
                                            <option selected="">@localizer.Text.Select</option>
                                            <option value="kk">International</option>
                                            <option value="zh-tw">台灣</option>
                                            <option value="en-sg">Singapore</option>
                                            <option value="th">ประเทศไทย</option>
                                            <option value="vi">Việt Nam</option>
                                            <option value="en-ph">Philippines</option>
                                            <option value="ko">대한민국</option>
                                            <option value="zh-hk">香港</option>
                                            <option value="en-id">Indonesia</option>
                                            <option value="ja">日本</option>
                                            <option value="zh-cn">中国</option>
                                            <option value="zh-my">Malaysia</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label>@localizer.Text.Currency @localizer.Text.CannotChange<span class="text-danger">*</span></label>
                                        <select id="currency" name="currency" class="form-control">
                                            <option selected="">@localizer.Text.Select</option>
                                            <option value="TWD">TWD @localizer.Text.CURR_TWD</option>
                                            <option value="HKD">HKD @localizer.Text.CURR_HKD</option>
                                            <option value="USD">USD @localizer.Text.CURR_USD</option>
                                            <option value="SGD">SGD @localizer.Text.CURR_SGD</option>
                                            <option value="MYR">MYR @localizer.Text.CURR_MYR</option>
                                            @*<option value="AUD">AUD @localizer.Text.CURR_AUD</option>
                                            <option value="CAD">CAD @localizer.Text.CURR_CAD</option>
                                            <option value="CNY">CNY @localizer.Text.CURR_CNY</option>
                                            <option value="EUR">EUR @localizer.Text.CURR_EUR</option>
                                            <option value="GBP">GBP @localizer.Text.CURR_GBP</option>
                                            <option value="IDR">IDR @localizer.Text.CURR_IDR</option>
                                            <option value="JPY">JPY @localizer.Text.CURR_JPY</option>
                                            <option value="KRW">KRW @localizer.Text.CURR_KRW</option>
                                            <option value="MYR">MYR @localizer.Text.CURR_MYR</option>
                                            <option value="NZD">NZD @localizer.Text.CURR_NZD</option>
                                            <option value="PHP">PHP @localizer.Text.CURR_PHP</option>
                                            <option value="SGD">SGD @localizer.Text.CURR_SGD</option>
                                            <option value="THB">THB @localizer.Text.CURR_THB</option>
                                            <option value="VND">VND @localizer.Text.CURR_VND</option>*@
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-7">
                                    <div class="form-group">
                                        <label>@localizer.Text.Company_Name<span class="text-danger">*</span></label>
                                        <input id="comp_name" name="comp_name" type="text" class="form-control">
                                    </div>
                                </div>
                                <div class="col-sm-5">
                                    <div class="form-group">
                                        <label>@localizer.Text.Company_Invoice</label>
                                        <input id="invoice" name="invoice" type="text" class="form-control" placeholder="@localizer.Text.OnlyTaiwan">
                                    </div>
                                </div>

                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <label>@localizer.Text.Company_Url</label>
                                        <input id="url" name="url"  type="text" class="form-control" placeholder="https://...">
                                    </div>
                                </div>

                                <div class="col-sm-12">
                                    <div class="form-group">
                                        <label>@localizer.Text.Company_Address</label>
                                        <input id="address" name="address" type="text" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-3">
                            <h2 class="section-title">營業資訊</h2>
                        </div>
                        <div class="col-md-9">
                            <h4>請提供至少一份下述文件</h4>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="file-upload-area">
                                        <div class="content">
                                            <h3>營業執照</h3>
                                            <div class="text-light">
                                                <a href="javascript:;" class="file-upload"><input type="file"></a>
                                                <div class="tip">(最大檔案限制：200MB)</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="file-upload-area">
                                        <div class="content">
                                            <h3>旅行社許可證</h3>

                                            <a href="javascript:;" class="file-upload"><input type="file"></a>
                                            <div class="tip">(最大檔案限制：200MB)</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="form-footer">
                    <label>
                        <input type="checkbox">我已閱讀並同意<a href="#">旅行代理條款</a>
                    </label>
                    <a href="#" id="CreatCompany" class="btn btn-primary" onclick="Register();">建立公司</a>
                </div>
            </div>
        </div>
    </div>
</form>
<script type="text/javascript">
    //驗證規則擴充
    $.validator.addMethod("phoneStyle", function( value, element )
    {
       var str = value;
       var result = false;

       if(str.length > 0){
           var patt_phone = /^[\d\-\(\)\#]{1,}$/;
           result = patt_phone.test(str);
       }
       else result = true;

       return result;
    }, "電話號碼不符合格式，僅接受數字、#-()等符號");


    $(function() {

        InitTmz();

        //初始化驗證規則
        $('#form_register').validate({
            rules:{
                gender_title: "required",
                name_first: "required",
                name_last: "required",
                email: { required: true,email:true },
                password: {required: true,rangelength:[8,12]},
                password_again: {required: true,rangelength:[8,12],equalTo:"#password"},
                country: "required",
                country_area: "required",
                timezone: "required",
                tel: {required: true,phoneStyle:true},
                locale: "required",
                currency: "required",
                comp_name: "required",
                invoice: {digits:true,rangelength:[8,8]},
                url: "url"
            },

            messages:{
                gender_title: "不可為空",
                name_first : "不可為空",
                name_last : "不可為空",
                email : {required:"不可為空",email:"請輸入有效的mail"},
                password : {required:"不可為空",rangelength:"密碼須介於8至12位數"},
                password_again :{required:"不可為空",rangelength:"密碼須介於8至12位數",equalTo:"密碼不相符"},
                country: "不可為空",
                country_area : "不可為空",
                timezone : "不可為空",
                tel : {required:"不可為空"},
                locale : "不可為空",
                currency : "不可為空",
                comp_name : "不可為空",
                invoice : {digits:"僅可輸入數字",rangelength:"統一編號須為8碼"},
                url : "請輸入正確網址"
            }
        });

    });

    function InitTmz(){
        var timeZones = moment.tz.names();
        var offsetTmz=[];

        for(var i in timeZones)
        {
            //offsetTmz.push({offset:moment.tz(timeZones[i]).format('Z'),name: timeZones[i]});
            var offset = moment.tz(timeZones[i]).format('Z');
            $('#timezone').append($('<option>', {
                value: timeZones[i]+ "," + offset,
                text: timeZones[i]+ " (" + offset + ")"}
            ));
        }
        //console.log(JSON.stringify(offsetTmz));
        var curr_tmz_str = Intl.DateTimeFormat().resolvedOptions().timeZone;
        $('#timezone option[value^="Asia/Taipei"]').attr("selected",true);
    }

    function Register(){

        if($('#readok').prop('checked') == false)
        {
            alert('請勾選同意旅行代理條款');
        }
        else
        {
            if ($('#form_register').valid()) {
                InsertCompany();
            }
            else  alert('請檢查以上欄位是否均填寫正確');
        }
        return false;
    }

    function InsertCompany() {
        var objComp = {
                        GENDER_TITLE:$('#gender_title').val(),
                        NAME_FIRST:$('#name_first').val(),
                        NAME_LAST:$('#name_last').val(),
                        EMAIL:$('#email').val(),
                        JOB_TITLE:$('#job_title').val(),
                        PASSWORD:$('#password').val(),
                        COUNTRY_CODE:$('#country_area').val(),
                        TIMEZONE:$('#timezone').val(),
                        TEL:$('#tel').val(),
                        LOCALE:$('#locale').val(),
                        CURRENCY:$('#currency').val(),
                        COMPANY_NAME:$('#comp_name').val(),
                        INVOICE:$('#invoice').val(),
                        URL:$('#url').val(),
                        ADDRESS:$('#address').val()
                };

        $.ajax({
                url: _root_path + 'Account/InsertCompany',
                type: 'POST',
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify(objComp),
                failure: function (data) {
                    console.log(data.responseText);
                },
                error: function (data) {
                    console.log(data.responseText);
                },
                success: function(result) {
                    if(result == "OK") {
                        $('#CreatCompany').attr("disabled","true");
                        alert('註冊已完成，請等候結果通知');
                        //window.location.href = result.url;
                    }
                    else {
                        alert(result.msg);
                    }
                }
        });
   }

</script>
